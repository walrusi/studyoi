<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Study Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background: #1c1c1e; /* Dark gray, common in macOS UI */
            color: #f5f5f7; /* Off-white text */
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #2c2c2e; /* Slightly lighter dark gray */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px; /* Apple-like rounded corners */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: #3a3a3c; /* Darker header */
            color: #f5f5f7;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: none;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            color: #f5f5f7;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #4a4a4e;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: #3a3a3c;
            color: #f5f5f7;
        }

        textarea:focus {
            outline: none;
            border-color: #0a84ff; /* Apple's blue focus color */
            box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.3);
        }

        .btn {
            background: #0a84ff; /* Apple blue */
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 10px 5px;
            font-weight: 500;
        }

        .btn:hover {
            background: #3395ff;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .quiz-container {
            display: none;
        }

        .question-card {
            background: #3a3a3c;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: none;
            border-left: 4px solid #0a84ff;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-number {
            background: #0a84ff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .topic-tag {
            background: rgba(10, 132, 255, 0.2);
            color: #3395ff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .question-text {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            color: #f5f5f7;
            line-height: 1.5;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            padding: 15px;
            border: 1px solid #4a4a4e;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #2c2c2e;
            color: #f5f5f7;
        }

        .option:hover {
            border-color: #0a84ff;
            background: #3a3a3c;
        }

        .option.selected {
            border-color: #0a84ff;
            background: rgba(10, 132, 255, 0.2);
        }

        .option.correct {
            border-color: #30d158; /* Apple green */
            background: rgba(48, 209, 88, 0.2);
            color: #f5f5f7;
        }

        .option.incorrect {
            border-color: #ff453a; /* Apple red */
            background: rgba(255, 69, 58, 0.2);
            color: #f5f5f7;
        }

        .results-container {
            display: none;
            background: #2c2c2e;
            border-radius: 10px;
            padding: 30px;
            margin-top: 20px;
        }

        .score-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .total-score {
            font-size: 3em;
            font-weight: bold;
            color: #0a84ff;
        }

        .topic-breakdown {
            margin-top: 30px;
        }

        .topic-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #3a3a3c;
            border-radius: 8px;
            border-left: 4px solid #0a84ff;
        }

        .topic-score.weak {
            border-left-color: #ff453a;
            background: rgba(255, 69, 58, 0.15);
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: #4a4a4e;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #0a84ff;
            transition: width 0.5s ease;
        }

        .progress-fill.weak {
            background: #ff453a;
        }

        .weak-areas {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 69, 58, 0.15);
            border-radius: 8px;
            border-left: 4px solid #ff453a;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> AI Study Tool</h1>
            <p>Transform your study notes into personalized quizzes</p>
        </div>

        <div class="content">
            <div id="api-section" class="section">
                <h2>OpenAI API Configuration</h2>
                <div style="background: rgba(79, 172, 254, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <p><strong> Privacy Note:</strong> Your API key is stored locally in your browser and never sent to any server except OpenAI's API.</p>
                </div>
                <input type="password" id="apiKey" placeholder="Enter your OpenAI API key (sk-...)" style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; margin-bottom: 10px;">
                <p style="font-size: 12px; color: #666; margin-bottom: 20px;">
                    Don't have an API key? Get one at <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #4facfe;">platform.openai.com/api-keys</a>
                </p>
            </div>

            <div id="input-section" class="section">
                <h2>Paste Your Study Material</h2>
                <textarea id="studyText" placeholder="Paste your study notes, outlines, or study guide here. Include headings and key concepts for best results.

Example:
# Biology Chapter 5: Cell Structure

## Cell Membrane
The cell membrane is a selectively permeable barrier that controls what enters and exits the cell. It is composed of a phospholipid bilayer with embedded proteins.

## Mitochondria
Mitochondria are the powerhouses of the cell, responsible for cellular respiration and ATP production..."></textarea>
                <div style="margin-top: 20px; margin-bottom: 10px;">
                    <label for="numQuestions" style="margin-right: 10px; font-weight: 500;">Suggested Questions:</label>
                    <input type="number" id="numQuestions" value="5" min="3" max="50" style="width: 80px; padding: 8px; border-radius: 6px; border: 1px solid #4a4a4e; background-color: #3a3a3c; color: #f5f5f7; font-size: 14px;">
                </div>
                <button id="generateQuiz" class="btn">Generate AI-Powered Quiz</button>
            </div>

                        <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p> AI is analyzing your study material and generating personalized questions...</p>
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">This may take 10-30 seconds</p>
            </div>

            <div id="quiz-section" class="quiz-container">
                <div class="section">
                    <h2>Your Personalized Quiz</h2>
                    <div id="quiz-content"></div>
                    <button id="submitQuiz" class="btn" style="display: none;">Submit Quiz</button>
                </div>
            </div>

            <div id="results-section" class="results-container">
                <div class="score-header">
                    <h2>Your Results</h2>
                    <div class="total-score" id="totalScore">0%</div>
                    <p id="scoreMessage"></p>
                </div>

                <div class="topic-breakdown">
                    <h3>Performance by Topic</h3>
                    <div id="topicScores"></div>
                </div>

                <div id="weakAreas" class="weak-areas" style="display: none;">
                    <h3>Areas for Review</h3>
                    <p>Focus your study time on these topics where you scored below 80%:</p>
                    <div id="weakTopics"></div>
                </div>

                <button id="retakeQuiz" class="btn">🔄 Take Another Quiz</button>
            </div>
        </div>
    </div>

    <script>
        class StudyTool {
            constructor() {
                this.questions = [];
                this.userAnswers = [];
                this.currentQuiz = null;
                this.init();
            }

            init() {
                document.getElementById('generateQuiz').addEventListener('click', () => this.generateQuiz());
                document.getElementById('submitQuiz').addEventListener('click', () => this.submitQuiz());
                document.getElementById('retakeQuiz').addEventListener('click', () => this.resetTool());
                document.getElementById('studyText').addEventListener('input', () => this.updateSuggestedQuestions());
                // Set initial suggested number based on placeholder text
                this.updateSuggestedQuestions();
            }

            async generateQuiz() {
                const apiKey = document.getElementById('apiKey').value.trim();
                const text = document.getElementById('studyText').value.trim();
                const numQuestions = document.getElementById('numQuestions').value;
                
                if (!apiKey) {
                    alert('Please enter your OpenAI API key first!');
                    return;
                }
                
                if (!text) {
                    alert('Please paste your study material first!');
                    return;
                }
                if (!numQuestions || numQuestions < 3 || numQuestions > 50) {
                    alert('Please enter a number of questions between 3 and 50.');
                    return;
                }

                this.showLoading(true);
                
                try {
                    const questions = await this.generateQuestionsWithAI(text, apiKey, numQuestions);
                    this.questions = questions;
                    this.displayQuiz();
                    this.showSection('quiz-section');
                } catch (error) {
                    console.error('Error generating quiz:', error);
                    alert(`Error generating quiz: ${error.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            async generateQuestionsWithAI(text, apiKey, numQuestions) {
                
                const prompt = `You are an expert educational content creator. Based on the following study material, generate exactly ${numQuestions} high-quality multiple-choice questions.

STUDY MATERIAL:
${text}

REQUIREMENTS:
1. Questions must test **deep understanding**, not just memorization. Include:
   - Conceptual reasoning
   - Word problems
   - Real-world application
   - Simple recall and definitions (for balance)
2. Each question must have exactly 4 answer choices (A, B, C, D), with one clearly correct.
3. Use a mix of difficulties: ~33% easy, 33% medium, 33% hard.
4. Distribute questions across **different topics** found in the material.
5. Make distractors (wrong answers) **plausible**, not obviously wrong.
6. Avoid overly niche trivia. Focus on the **core concepts**
7. At least 60–70% of questions must be **scenario-based word problems**. Use vivid, creative real-world setups (e.g., "A student named Maya...").
8. You may enrich the questions with minimal outside context if a concept is only briefly mentioned. For example, if “classical conditioning” appears but isn’t explained, assume the standard definition and use it to build realistic scenarios.

RESPONSE FORMAT - Return a valid JSON array like this:
[
  {
    "question": "What is the primary function of mitochondria?",
    "options": [
      "Energy production through cellular respiration",
      "Protein synthesis and assembly",
      "DNA replication and storage",
      "Waste removal and detoxification"
    ],
    "correct": 0,
    "topic": "Cell Biology",
    "explanation": "Mitochondria are known as the powerhouses of the cell because they produce ATP through cellular respiration."
  }
]

Generate exactly ${numQuestions} questions covering the most important concepts from the provided material.`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are an expert educational content creator who generates high-quality multiple-choice questions. Always respond with valid JSON only.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.85,
                        max_tokens: 3000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API request failed with status ${response.status}`);
                }

                const data = await response.json();
                const content = data.choices[0].message.content.trim();
                
                // Parse JSON response
                let questions;
                try {
                    // Remove any markdown code blocks if present
                    const jsonMatch = content.match(/```(?:json)?\s*([\s\S]*?)\s*```/) || [null, content];
                    const jsonStr = jsonMatch[1];
                    questions = JSON.parse(jsonStr);
                } catch (parseError) {
                    throw new Error('Failed to parse AI response. Please try again.');
                }

                // Validate and format questions
                if (!Array.isArray(questions)) {
                    throw new Error('Invalid response format from AI');
                }

                return questions.map((q, index) => ({
                    id: index + 1,
                    question: q.question,
                    options: q.options,
                    correct: q.correct,
                    topic: q.topic || 'General',
                    explanation: q.explanation || '',
                    type: 'ai-generated'
                }));
            }

            updateSuggestedQuestions() {
                const text = document.getElementById('studyText').value;
                const numQuestionsInput = document.getElementById('numQuestions');
                const suggestedCount = this.calculateNumberOfQuestions(text);
                numQuestionsInput.value = suggestedCount;
            }

            calculateNumberOfQuestions(text) {
                const wordCount = text.split(/\s+/).filter(Boolean).length;
                if (wordCount < 100) { // For very short text or the initial placeholder
                    return 5;
                }
                // Estimate one question per ~75 words of text
                const estimatedQuestions = Math.floor(wordCount / 75);
                const calculated = Math.max(3, estimatedQuestions); // Ensure at least 3 questions
                return Math.min(calculated, 50); // Cap at a maximum of 50 questions
            }

            extractTopics(text) {
                const topics = new Set(['General']);
                
                // Extract topics from markdown headers
                const headerRegex = /^#{1,3}\s+(.+)$/gm;
                let match;
                while ((match = headerRegex.exec(text)) !== null) {
                    topics.add(match[1].trim());
                }

                // Extract topics from common patterns
                const topicPatterns = [
                    /chapter\s+\d+[:\-]\s*(.+)/gi,
                    /section\s+\d+[:\-]\s*(.+)/gi,
                    /unit\s+\d+[:\-]\s*(.+)/gi
                ];

                topicPatterns.forEach(pattern => {
                    let match;
                    while ((match = pattern.exec(text)) !== null) {
                        topics.add(match[1].trim());
                    }
                });

                return Array.from(topics);
            }



            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            displayQuiz() {
                const container = document.getElementById('quiz-content');
                container.innerHTML = '';

                this.questions.forEach((q, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-card';
                    
                    questionDiv.innerHTML = `
                        <div class="question-header">
                            <div class="question-number">${index + 1}</div>
                            <div class="topic-tag">${q.topic}</div>
                        </div>
                        <div class="question-text">${q.question}</div>
                        <div class="options">
                            ${q.options.map((option, optIndex) => `
                                <div class="option" data-question="${index}" data-option="${optIndex}">
                                    ${String.fromCharCode(65 + optIndex)}. ${option}
                                </div>
                            `).join('')}
                        </div>
                    `;

                    container.appendChild(questionDiv);
                });

                // Add click handlers for options
                document.querySelectorAll('.option').forEach(option => {
                    option.addEventListener('click', (e) => this.selectOption(e));
                });

                document.getElementById('submitQuiz').style.display = 'block';
            }

            selectOption(e) {
                const questionIndex = parseInt(e.target.dataset.question);
                const optionIndex = parseInt(e.target.dataset.option);

                // Remove previous selection
                document.querySelectorAll(`[data-question="${questionIndex}"]`).forEach(opt => {
                    opt.classList.remove('selected');
                });

                // Add selection
                e.target.classList.add('selected');

                // Store answer
                this.userAnswers[questionIndex] = optionIndex;
            }

            submitQuiz() {
                if (this.userAnswers.length !== this.questions.length) {
                    alert('Please answer all questions before submitting!');
                    return;
                }

                this.showResults();
                this.showSection('results-section');
            }

            showResults() {
                const results = this.calculateResults();
                
                // Update total score
                document.getElementById('totalScore').textContent = `${results.totalPercent}%`;
                document.getElementById('scoreMessage').textContent = this.getScoreMessage(results.totalPercent);

                // Update topic breakdown
                this.displayTopicBreakdown(results.topicScores);

                // Show weak areas
                this.displayWeakAreas(results.weakTopics);
            }

            calculateResults() {
                let correct = 0;
                const topicScores = {};

                this.questions.forEach((question, index) => {
                    const userAnswer = this.userAnswers[index];
                    const isCorrect = userAnswer === question.correct;
                    
                    if (isCorrect) correct++;

                    // Track by topic
                    if (!topicScores[question.topic]) {
                        topicScores[question.topic] = { correct: 0, total: 0 };
                    }
                    topicScores[question.topic].total++;
                    if (isCorrect) {
                        topicScores[question.topic].correct++;
                    }

                    // Visual feedback on questions
                    const options = document.querySelectorAll(`[data-question="${index}"]`);
                    options.forEach((option, optIndex) => {
                        if (optIndex === question.correct) {
                            option.classList.add('correct');
                        } else if (optIndex === userAnswer && !isCorrect) {
                            option.classList.add('incorrect');
                        }
                    });
                });

                const totalPercent = Math.round((correct / this.questions.length) * 100);
                
                // Calculate topic percentages
                const topicPercentages = {};
                const weakTopics = [];

                Object.keys(topicScores).forEach(topic => {
                    const percent = Math.round((topicScores[topic].correct / topicScores[topic].total) * 100);
                    topicPercentages[topic] = percent;
                    
                    if (percent < 80) {
                        weakTopics.push(topic);
                    }
                });

                return {
                    totalPercent,
                    topicScores: topicPercentages,
                    weakTopics
                };
            }

            displayTopicBreakdown(topicScores) {
                const container = document.getElementById('topicScores');
                container.innerHTML = '';

                Object.keys(topicScores).forEach(topic => {
                    const percent = topicScores[topic];
                    const isWeak = percent < 80;
                    
                    const scoreDiv = document.createElement('div');
                    scoreDiv.className = `topic-score ${isWeak ? 'weak' : ''}`;
                    
                    scoreDiv.innerHTML = `
                        <span>${topic}</span>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="progress-bar">
                                <div class="progress-fill ${isWeak ? 'weak' : ''}" style="width: ${percent}%"></div>
                            </div>
                            <strong>${percent}%</strong>
                        </div>
                    `;
                    
                    container.appendChild(scoreDiv);
                });
            }

            displayWeakAreas(weakTopics) {
                const weakAreasDiv = document.getElementById('weakAreas');
                
                if (weakTopics.length === 0) {
                    weakAreasDiv.style.display = 'none';
                } else {
                    weakAreasDiv.style.display = 'block';
                    const container = document.getElementById('weakTopics');
                    container.innerHTML = weakTopics.map(topic => 
                        `<div style="margin: 5px 0; font-weight: bold; color: #dc3545;">• ${topic}</div>`
                    ).join('');
                }
            }

            getScoreMessage(percent) {
                if (percent >= 90) return "Excellent! You've mastered this material! 🌟";
                if (percent >= 80) return "Great job! You have a strong understanding! 👏";
                if (percent >= 70) return "Good work! A little more review and you'll be ready! 📚";
                if (percent >= 60) return "You're getting there! Focus on the weak areas! 💪";
                return "Keep studying! Review the material and try again! 📖";
            }

            showSection(sectionId) {
                // Hide all sections
                document.getElementById('input-section').style.display = 'none';
                document.getElementById('quiz-section').style.display = 'none';
                document.getElementById('results-section').style.display = 'none';
                
                // Show target section
                document.getElementById(sectionId).style.display = 'block';
            }

            showLoading(show) {
                document.getElementById('loading').classList.toggle('hidden', !show);
            }

            resetTool() {
                this.questions = [];
                this.userAnswers = [];
                document.getElementById('studyText').value = '';
                document.getElementById('api-section').style.display = 'block';
                document.getElementById('input-section').style.display = 'block';
                document.getElementById('quiz-section').style.display = 'none';
                document.getElementById('results-section').style.display = 'none';
                document.getElementById('submitQuiz').style.display = 'none';
            }
        }

        // Initialize the study tool when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new StudyTool();
        });
    </script>
</body>
</html>